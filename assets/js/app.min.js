function email_test(input) {
    return !/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/.test(input.value);
}

//BildSlider
let sliders = document.querySelectorAll('._swiper');
if (sliders) {
    for (let index = 0; index < sliders.length; index++) {
        let slider = sliders[index];
        if (!slider.classList.contains('swiper-bild')) {
            let slider_items = slider.children;
            if (slider_items) {
                for (let index = 0; index < slider_items.length; index++) {
                    let el = slider_items[index];
                    el.classList.add('swiper-slide');
                }
            }
            let slider_content = slider.innerHTML;
            let slider_wrapper = document.createElement('div');
            slider_wrapper.classList.add('swiper-wrapper');
            slider_wrapper.innerHTML = slider_content;
            slider.innerHTML = '';
            slider.appendChild(slider_wrapper);
            slider.classList.add('swiper-bild');

            if (slider.classList.contains('_swiper_scroll')) {
                let sliderScroll = document.createElement('div');
                sliderScroll.classList.add('swiper-scrollbar');
                slider.appendChild(sliderScroll);
            }
        }
        if (slider.classList.contains('_gallery')) {
            //slider.data('lightGallery').destroy(true);
        }
    }
    sliders_bild_callback();
}

function sliders_bild_callback(params) { }

let sliderScrollItems = document.querySelectorAll('._swiper_scroll');
if (sliderScrollItems.length > 0) {
    for (let index = 0; index < sliderScrollItems.length; index++) {
        const sliderScrollItem = sliderScrollItems[index];
        const sliderScrollBar = sliderScrollItem.querySelector('.swiper-scrollbar');
        const sliderScroll = new Swiper(sliderScrollItem, {
            observer: true,
            observeParents: true,
            direction: 'vertical',
            slidesPerView: 'auto',
            freeMode: true,
            scrollbar: {
                el: sliderScrollBar,
                draggable: true,
                snapOnRelease: false
            },
            mousewheel: {
                releaseOnEdges: true,
            },
        });
        sliderScroll.scrollbar.updateSize();
    }
}


function sliders_bild_callback(params) { }

//Главный слайдер
let pageSlider = new Swiper('.page__slider', {
    observer: true,
    observeParents: true,
    slidesPerView: 1,
    spaceBetween: 100,
    autoHeight: true,
    speed: 600,
    simulateTouch: true,
    allowTouchMove: true,

    effect: "fade",

    fadeEffect: {
        crossFade: true,
    },
    autoplay: {
        delay: 10000,
        disableOnInteraction: true,
    },

});

// Шаблоны ===========================================
let templatesSlider = new Swiper('.templates__slider', {
    observer: true,
    observeParents: true,
    slidesPerView: 1,
    spaceBetween: 30,
    speed: 800,
    initialSlide: 1,
    loop: true,
    effect: "fade",

    fadeEffect: {
        crossFade: true,
    },
    pagination: {
        el: '.swiper-pagination',
        type: 'fraction',
    },
    navigation: {
        nextEl: '.templates__arrow-next',
        prevEl: '.templates__arrow-prev',
    },

});
//==================================================

// Услуги ===========================================
let advantage = new Swiper('.prices__row', {
    observer: true,
    observeParents: true,
    slidesPerView: 'auto',
    preloadImages: false,
    speed: 800,
    allowTouchMove: true,

    breakpoints: {
        1280: {
            allowTouchMove: false,
        }
    },
    scrollbar: {
        el: '.prices-pagination',
        draggable: true,
    },
});
//==================================================

//invitation_no_4 =====================================

//Фото
let galleryItems = new Swiper('.in4-gallery__items', {
    observer: true,
    observeParents: true,
    slidesPerView: 1,
    spaceBetween: 80,
    autoHeight: false,
    slidesPerColumn: 1,
    speed: 800,

    pagination: {
        el: '.in4-swiper-pagination',
        type: 'fraction'
    },
    navigation: {
        nextEl: '.in4-gallery__arrow-next',
        prevEl: '.in4-gallery__arrow-prev',
    },
    breakpoints: {
        992: {
            slidesPerView: 3,
            spaceBetween: 20,
        },
        768: {
            slidesPerView: 2,
            spaceBetween: 20,
        },
        478: {
            slidesPerView: 1,
            spaceBetween: 20,
        },
    },
});


//Видео
let galleryVideo = new Swiper('.in4-gallery__video-all', {
    observer: true,
    observeParents: true,
    slidesPerView: 1,
    spaceBetween: 80,
    autoHeight: false,
    slidesPerColumn: 1,
    speed: 800,
    loop: true,
    autoplay: {
        delay: 5000,
        disableOnInteraction: true,
    },
    navigation: {
        nextEl: '.in4-gallery__video-arrow-next',
        prevEl: '.in4-gallery__video-arrow-prev',
    },
    breakpoints: {
        992: {
            slidesPerView: 3,
            spaceBetween: 20,
        },
        768: {
            slidesPerView: 2,
            spaceBetween: 20,
        },
        478: {
            slidesPerView: 1,
            spaceBetween: 20,
        },
    },
});
//================================================== 

//invitation_no_5 =====================================
let GallerySlider = new Swiper('.in5-gallery__slider', {
    observer: true,
    observeParents: true,
    slidesPerView: 'auto',
    centeredSlides: true,
    spaceBetween: 0,
    speed: 800,
    loop: true,

    autoplay: {
        delay: 8000,
        disableOnInteraction: true,
    },
    pagination: {
        el: '.in5-gallery__dotts',
        clickable: true,
    },
});


let ContactsSlider = new Swiper('.in5-contacts__slider', {
    observer: true,
    observeParents: true,
    slidesPerView: 'auto',
    centeredSlides: true,
    spaceBetween: 100,
    speed: 800,

    autoplay: {
        delay: 5000,
        disableOnInteraction: true,
    },
    pagination: {
        el: '.in5-contacts__dotts',
        clickable: true,
    },
});
//================================================== 

let ua = window.navigator.userAgent;
const msie = ua.indexOf('MSIE ');
var isMobile = {
    Android() { return navigator.userAgent.match(/Android/i); }, BlackBerry() { return navigator.userAgent.match(/BlackBerry/i); }, iOS() { return navigator.userAgent.match(/iPhone|iPad|iPod/i); }, Opera() { return navigator.userAgent.match(/Opera Mini/i); }, Windows() { return navigator.userAgent.match(/IEMobile/i); }, any() { return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows()); },
};
function isIE() {
    ua = navigator.userAgent;
    const is_ie = ua.indexOf('MSIE ') > -1 || ua.indexOf('Trident/') > -1;
    return is_ie;
}
if (isIE()) {
    document.querySelector('html').classList.add('ie');
}
if (isMobile.any()) {
    document.querySelector('html').classList.add('_touch');
}

// Получить цифры из строки
// parseInt(itemContactpagePhone.replace(/[^\d]/g, ''))

function testWebP(callback) {
    const webP = new Image();
    webP.onload = webP.onerror = function () {
        callback(webP.height == 2);
    };
    webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';
}
testWebP((support) => {
    if (support === true) {
        document.querySelector('html').classList.add('_webp');
    } else {
        document.querySelector('html').classList.add('_no-webp');
    }
});

window.addEventListener('load', () => {
    if (document.querySelector('.wrapper, .in1-wrapper, .in2-wrapper, .in3-wrapper, .in4-wrapper, .in5-wrapper, .in7-wrapper, .in10-wrapper')) {
        setTimeout(() => {
            document.querySelector('.wrapper, .in1-wrapper, .in2-wrapper, .in3-wrapper, .in4-wrapper, .in5-wrapper, .in7-wrapper, .in10-wrapper').classList.add('_loaded');
        }, 0);
    }
});

let unlock = true;

//= ================
// ActionsOnHash
if (location.hash) {
    const hsh = location.hash.replace('#', '');
    if (document.querySelector(`.popup_${hsh}`)) {
        popup_open(hsh);
    } else if (document.querySelector(`div.${hsh}`)) {
        _goto(document.querySelector(`.${hsh}`), 500, '');
    }
}
//= ================
// Menu
const iconMenu = document.querySelector('.icon-menu, .in1-header__icon, .in3-header__icon, .in4-header__icon, .in5-header__icon, .in7-header__icon, .in10-header__icon');
if (iconMenu != null) {
    const delay = 500;
    const menuBody = document.querySelector('.menu__body, .in1-menu__body, .in3-menu__body, .in4-menu__body, .in5-menu__body, .in7-menu__body, .in10-menu__body');
    iconMenu.addEventListener('click', (e) => {
        if (unlock) {
            body_lock(delay);
            iconMenu.classList.toggle('_active');
            menuBody.classList.toggle('_active');
        }
    });
}
function menu_close() {
    const iconMenu = document.querySelector('.icon-menu, .in1-header__icon, .in3-header__icon, .in4-header__icon , .in5-header__icon, .in7-header__icon, .in10-header__icon');
    const menuBody = document.querySelector('.menu__body, .in1-menu__body,  .in3-menu__body, .in4-menu__body, .in5-menu__body, .in7-menu__body, .in10-menu__body');
    iconMenu.classList.remove('_active');
    menuBody.classList.remove('_active');
}
//= ================
// BodyLock
function body_lock(delay) {
    const body = document.querySelector('body');
    if (body.classList.contains('_lock')) {
        body_lock_remove(delay);
    } else {
        body_lock_add(delay);
    }
}
function body_lock_remove(delay) {
    const body = document.querySelector('body');
    if (unlock) {
        const lock_padding = document.querySelectorAll('._lp');
        setTimeout(() => {
            for (let index = 0; index < lock_padding.length; index++) {
                const el = lock_padding[index];
                el.style.paddingRight = '0px';
            }
            body.style.paddingRight = '0px';
            body.classList.remove('_lock');
        }, delay);

        unlock = false;
        setTimeout(() => {
            unlock = true;
        }, delay);
    }
}
function body_lock_add(delay) {
    const body = document.querySelector('body');
    if (unlock) {
        const lock_padding = document.querySelectorAll('._lp');
        for (let index = 0; index < lock_padding.length; index++) {
            const el = lock_padding[index];
            el.style.paddingRight = `${window.innerWidth - document.querySelector('.wrapper, .in1-wrapper, .in2-wrapper, .in3-wrapper, .in4-wrapper, .in5-wrapper, .in7-wrapper, .in8-wrapper, .in9-wrapper, .in10-wrapper').offsetWidth}px`;
        }
        body.style.paddingRight = `${window.innerWidth - document.querySelector('.wrapper, .in1-wrapper, .in2-wrapper, .in3-wrapper, .in4-wrapper, .in5-wrapper, .in7-wrapper, .in8-wrapper, .in9-wrapper, .in10-wrapper').offsetWidth}px`;
        body.classList.add('_lock');

        unlock = false;
        setTimeout(() => {
            unlock = true;
        }, delay);
    }
}

//= ================
// DigiFormat
function digi(str) {
    const r = str.toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g, '$1 ');
    return r;
}

//= ================
// Popups
const popup_link = document.querySelectorAll('._popup-link');
const popups = document.querySelectorAll('.popup');
for (let index = 0; index < popup_link.length; index++) {
    const el = popup_link[index];
    el.addEventListener('click', (e) => {
        if (unlock) {
            const item = el.getAttribute('href').replace('#', '');
            const video = el.getAttribute('data-video');
            popup_open(item, video);
        }
        e.preventDefault();
    });
}
for (let index = 0; index < popups.length; index++) {
    const popup = popups[index];
    popup.addEventListener('click', (e) => {
        if (!e.target.closest('.popup__body')) {
            popup_close(e.target.closest('.popup'));
        }
    });
}
function popup_open(item, video = '') {
    const activePopup = document.querySelectorAll('.popup._active');
    if (activePopup.length > 0) {
        popup_close('', false);
    }
    const curent_popup = document.querySelector(`.popup_${item}`);
    if (curent_popup && unlock) {
        if (video != '' && video != null) {
            const popup_video = document.querySelector('.popup_video');
            popup_video.querySelector('.popup__video').innerHTML = `<iframe src="https://www.youtube.com/embed/${video}?autoplay=1"  allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
        }
        if (!document.querySelector('.menu__body._active, .in1-menu__body._active, .in3-menu__body._active, .in4-menu__body._active, .in5-menu__body._active, .in7-menu__body._active')) {
            body_lock_add(500);
        }
        curent_popup.classList.add('_active');
        history.pushState('', '', `#${item}`);
    }
}
function popup_close(item, bodyUnlock = true) {
    if (unlock) {
        if (!item) {
            for (let index = 0; index < popups.length; index++) {
                const popup = popups[index];
                const video = popup.querySelector('.popup__video');
                if (video) {
                    video.innerHTML = '';
                }
                popup.classList.remove('_active');
            }
        } else {
            const video = item.querySelector('.popup__video');
            if (video) {
                video.innerHTML = '';
            }
            item.classList.remove('_active');
        }
        if (!document.querySelector('.menu__body._active, .in1-menu__body._active , .in3-menu__body._active, .in4-menu__body._active , .in5-menu__body._active, .in7-menu__body._active') && bodyUnlock) {
            body_lock_remove(500);
        }
        history.pushState('', '', window.location.href.split('#')[0]);
    }
}
const popup_close_icon = document.querySelectorAll('.popup__close,._popup-close');
if (popup_close_icon) {
    for (let index = 0; index < popup_close_icon.length; index++) {
        const el = popup_close_icon[index];
        el.addEventListener('click', () => {
            popup_close(el.closest('.popup'));
        });
    }
}
document.addEventListener('keydown', (e) => {
    if (e.code === 'Escape') {
        popup_close();
    }
});
//= ================
// SlideToggle
const _slideUp = (target, duration = 500) => {
    if (!target.classList.contains('_slide')) {
        target.classList.add('_slide');
        target.style.transitionProperty = 'height, margin, padding';
        target.style.transitionDuration = `${duration}ms`;
        target.style.height = `${target.offsetHeight}px`;
        target.offsetHeight;
        target.style.overflow = 'hidden';
        target.style.height = 0;
        target.style.paddingTop = 0;
        target.style.paddingBottom = 0;
        target.style.marginTop = 0;
        target.style.marginBottom = 0;
        window.setTimeout(() => {
            target.hidden = true;
            target.style.removeProperty('height');
            target.style.removeProperty('padding-top');
            target.style.removeProperty('padding-bottom');
            target.style.removeProperty('margin-top');
            target.style.removeProperty('margin-bottom');
            target.style.removeProperty('overflow');
            target.style.removeProperty('transition-duration');
            target.style.removeProperty('transition-property');
            target.classList.remove('_slide');
        }, duration);
    }
};
const _slideDown = (target, duration = 500) => {
    if (!target.classList.contains('_slide')) {
        target.classList.add('_slide');
        if (target.hidden) {
            target.hidden = false;
        }
        const height = target.offsetHeight;
        target.style.overflow = 'hidden';
        target.style.height = 0;
        target.style.paddingTop = 0;
        target.style.paddingBottom = 0;
        target.style.marginTop = 0;
        target.style.marginBottom = 0;
        target.offsetHeight;
        target.style.transitionProperty = 'height, margin, padding';
        target.style.transitionDuration = `${duration}ms`;
        target.style.height = `${height}px`;
        target.style.removeProperty('padding-top');
        target.style.removeProperty('padding-bottom');
        target.style.removeProperty('margin-top');
        target.style.removeProperty('margin-bottom');
        window.setTimeout(() => {
            target.style.removeProperty('height');
            target.style.removeProperty('overflow');
            target.style.removeProperty('transition-duration');
            target.style.removeProperty('transition-property');
            target.classList.remove('_slide');
        }, duration);
    }
};
const _slideToggle = (target, duration = 500) => {
    if (target.hidden) {
        return _slideDown(target, duration);
    }
    return _slideUp(target, duration);
};
// IsHidden
function _is_hidden(el) {
    return (el.offsetParent === null);
}
//= =======================================
// Tabs

document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('._tabs');
    tabs.forEach((tab) => {
        const tabs_items = tab.querySelectorAll('._tabs-item');
        const tabs_blocks = tab.querySelectorAll('._tabs-block');
        const hiddenInput = tab.querySelector('input[type="hidden"][name="input-survey-items"]');

        tabs_items.forEach((tabs_item, index) => {
            tabs_item.addEventListener('click', (e) => {
                tabs_items.forEach((item) => item.classList.remove('_active'));
                tabs_blocks.forEach((block) => block.classList.remove('_active'));

                tabs_item.classList.add('_active');

                const correspondingBlock = tabs_blocks[index];
                if (correspondingBlock) {
                    correspondingBlock.classList.add('_active');
                    hiddenInput.value = tabs_item.textContent.trim();
                }

                e.preventDefault();
            });
        });
    });
});

const in6Tabs = document.querySelectorAll('._in6-tabs');
for (let index = 0; index < in6Tabs.length; index++) {
    const in6Tab = in6Tabs[index];
    const in6Tabs_items = in6Tab.querySelectorAll('._in6-tabs-item');
    const in6Tabs_blocks = in6Tab.querySelectorAll('._in6-tabs-block');
    for (let index = 0; index < in6Tabs_items.length; index++) {
        const in6Tabs_item = in6Tabs_items[index];
        in6Tabs_item.addEventListener('click', (e) => {
            for (let index = 0; index < in6Tabs_items.length; index++) {
                const in6Tabs_item = in6Tabs_items[index];
                in6Tabs_item.classList.remove('_active');
                in6Tabs_blocks[index].classList.remove('_active');
                document.querySelector('.in6-page__body').classList.add('_active');
            }
            in6Tabs_item.classList.add('_active');
            in6Tabs_blocks[index].classList.add('_active');
            e.preventDefault();
        });
    }
}

const in8Tabs = document.querySelectorAll('._in8-tabs');
for (let index = 0; index < in8Tabs.length; index++) {
    const in8Tab = in8Tabs[index];
    const in8Tabs_items = in8Tab.querySelectorAll('._in8-tabs-item');
    const in8Tabs_blocks = in8Tab.querySelectorAll('._in8-tabs-block');
    for (let index = 0; index < in8Tabs_items.length; index++) {
        const in8Tabs_item = in8Tabs_items[index];
        in8Tabs_item.addEventListener('click', (e) => {
            for (let index = 0; index < in8Tabs_items.length; index++) {
                const in8Tabs_item = in8Tabs_items[index];
                in8Tabs_item.classList.remove('_active');
                in8Tabs_blocks[index].classList.remove('_active');
            }
            in8Tabs_item.classList.add('_active');
            in8Tabs_blocks[index].classList.add('_active');
            e.preventDefault();
        });
    }
}
//= ================
// SPOLLERS
const spollersArray = document.querySelectorAll('[data-spollers]');
if (spollersArray.length > 0) {
    // Получение обычных слойлеров
    const spollersRegular = Array.from(spollersArray).filter((item, index, self) => !item.dataset.spollers.split(',')[0]);
    // Инициализация обычных слойлеров
    if (spollersRegular.length > 0) {
        initSpollers(spollersRegular);
    }

    // Получение слойлеров с медиа запросами
    const spollersMedia = Array.from(spollersArray).filter((item, index, self) => item.dataset.spollers.split(',')[0]);

    // Инициализация слойлеров с медиа запросами
    if (spollersMedia.length > 0) {
        const breakpointsArray = [];
        spollersMedia.forEach((item) => {
            const params = item.dataset.spollers;
            const breakpoint = {};
            const paramsArray = params.split(',');
            breakpoint.value = paramsArray[0];
            breakpoint.type = paramsArray[1] ? paramsArray[1].trim() : 'max';
            breakpoint.item = item;
            breakpointsArray.push(breakpoint);
        });

        // Получаем уникальные брейкпоинты
        let mediaQueries = breakpointsArray.map((item) => `(${item.type}-width: ${item.value}px),${item.value},${item.type}`);
        mediaQueries = mediaQueries.filter((item, index, self) => self.indexOf(item) === index);

        // Работаем с каждым брейкпоинтом
        mediaQueries.forEach((breakpoint) => {
            const paramsArray = breakpoint.split(',');
            const mediaBreakpoint = paramsArray[1];
            const mediaType = paramsArray[2];
            const matchMedia = window.matchMedia(paramsArray[0]);

            // Объекты с нужными условиями
            const spollersArray = breakpointsArray.filter((item) => {
                if (item.value === mediaBreakpoint && item.type === mediaType) {
                    return true;
                }
            });
            // Событие
            matchMedia.addListener(() => {
                initSpollers(spollersArray, matchMedia);
            });
            initSpollers(spollersArray, matchMedia);
        });
    }
    // Инициализация
    function initSpollers(spollersArray, matchMedia = false) {
        spollersArray.forEach((spollersBlock) => {
            spollersBlock = matchMedia ? spollersBlock.item : spollersBlock;
            if (matchMedia.matches || !matchMedia) {
                spollersBlock.classList.add('_init');
                initSpollerBody(spollersBlock);
                spollersBlock.addEventListener('click', setSpollerAction);
            } else {
                spollersBlock.classList.remove('_init');
                initSpollerBody(spollersBlock, false);
                spollersBlock.removeEventListener('click', setSpollerAction);
            }
        });
    }
    // Работа с контентом
    function initSpollerBody(spollersBlock, hideSpollerBody = true) {
        const spollerTitles = spollersBlock.querySelectorAll('[data-spoller]');
        if (spollerTitles.length > 0) {
            spollerTitles.forEach((spollerTitle) => {
                if (hideSpollerBody) {
                    spollerTitle.removeAttribute('tabindex');
                    if (!spollerTitle.classList.contains('_active')) {
                        spollerTitle.nextElementSibling.hidden = true;
                    }
                } else {
                    spollerTitle.setAttribute('tabindex', '-1');
                    spollerTitle.nextElementSibling.hidden = false;
                }
            });
        }
    }
    function setSpollerAction(e) {
        const el = e.target;
        if (el.hasAttribute('data-spoller') || el.closest('[data-spoller]')) {
            const spollerTitle = el.hasAttribute('data-spoller') ? el : el.closest('[data-spoller]');
            const spollersBlock = spollerTitle.closest('[data-spollers]');
            const oneSpoller = !!spollersBlock.hasAttribute('data-one-spoller');
            if (!spollersBlock.querySelectorAll('._slide').length) {
                if (oneSpoller && !spollerTitle.classList.contains('_active')) {
                    hideSpollersBody(spollersBlock);
                }
                spollerTitle.classList.toggle('_active');
                _slideToggle(spollerTitle.nextElementSibling, 500);
            }
            e.preventDefault();
        }
    }
    function hideSpollersBody(spollersBlock) {
        const spollerActiveTitle = spollersBlock.querySelector('[data-spoller]._active');
        if (spollerActiveTitle) {
            spollerActiveTitle.classList.remove('_active');
            _slideUp(spollerActiveTitle.nextElementSibling, 500);
        }
    }
}
//= ================
// Gallery
const gallery = document.querySelectorAll('._gallery');
if (gallery) {
    gallery_init();
}
function gallery_init() {
    for (let index = 0; index < gallery.length; index++) {
        const el = gallery[index];
        lightGallery(el, {
            counter: false,
            selector: 'a',
            download: false,
        });
    }
}
//= ================

// Добавление анимации элементам ====================
const animItems = document.querySelectorAll('._anim-items');
const animEl = document.querySelectorAll('._anim-item');

if (animItems.length > 0) {
    for (let index = 0; index < animEl.length; index++) {
        const animDisplay = animEl[index];
        animDisplay.classList.add('_hide');
    }
    window.addEventListener('scroll', animOnScroll);
    function animOnScroll() {
        for (let index = 0; index < animItems.length; index++) {
            const animItem = animItems[index];
            const animItemHeight = animItem.offsetHeight;
            const animItemOffset = offset(animItem).top;
            const animStart = 4;

            let animItemPoint = window.innerHeight - animItemHeight / animStart;
            if (animItemHeight > window.innerHeight) {
                animItemPoint = window.innerHeight - window.innerHeight / animStart;
            }

            if ((pageYOffset > animItemOffset - animItemPoint) && pageYOffset < (animItemOffset + animItemHeight)) {
                animItem.classList.add('_active');
            } else if (!animItem.classList.contains('_anim-no-hide')) {
                animItem.classList.remove('_active');
            }
        }
    }
    function offset(el) {
        const rect = el.getBoundingClientRect();
        const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        return { top: rect.top + scrollTop, left: rect.left + scrollLeft };
    }

    setTimeout(() => {
        animOnScroll();
    }, 300);
}
// ===================================================

// Всплывающий Header ================================
let oldScrollY = 0;
const div = document.querySelector('.header');

window.addEventListener('scroll', () => {
    const scrolled = window.pageYOffset || document.documentElement.scrollTop;
    const dY = scrolled - oldScrollY;

    if (div) {
        if (dY < 0) {
            div.classList.add('header-fixed');
        } else {
            div.classList.remove('header-fixed');
        }
    }
    oldScrollY = scrolled;
});
// ====================================================

// Анимация голубей =================================
const in2Decor = document.querySelectorAll('.in2-decor');
const x = document.documentElement.clientWidth;
if (x >= '950') {
    for (let i = 0; i < in2Decor.length; i++) {
        window.addEventListener('mousemove', (e) => {
            const x = e.clientX / window.innerWidth;
            const y = e.clientY / window.innerHeight;
            in2Decor[i].style.transform = `translate(-${x * 40}px, -${y * 40}px)`;
        });
    }
}
// ===================================================

// invitation_no_2 =====================================
const radioYes = document.getElementById('radio-yes');
const radioNo = document.getElementById('radio-no');
const otherRadioButtons = document.querySelectorAll('input[type="radio"]:not(#radio-yes):not(#radio-no)');
const checkboxes = document.querySelectorAll('.in1-checkbox__input');

if (radioYes && radioNo) {
    if (otherRadioButtons.length > 0) {
        radioYes.addEventListener('change', () => {
            if (radioYes.checked) {
                otherRadioButtons.forEach((radio) => {
                    radio.disabled = false;
                    radio.classList.remove('_active');
                });
                checkboxes.forEach((checkbox) => {
                    checkbox.disabled = false;
                    checkbox.classList.remove('_active');
                });
            }
        });

        radioNo.addEventListener('change', () => {
            if (radioNo.checked) {
                otherRadioButtons.forEach((radio) => {
                    radio.checked = false;
                    radio.disabled = true;
                    radio.classList.add('_active');
                });
                checkboxes.forEach((checkbox) => {
                    checkbox.checked = false;
                    checkbox.disabled = true;
                    checkbox.classList.add('_active');
                });
            }
        });
    }
}

//= ================================================================================

// invitation_no_3 =====================================
const in4Timer = document.querySelectorAll('.in4-timer, .in10-timer');
if (in4Timer.length > 0) {
    const date = new Date('2024-12-31T00:00:00');
    function counts() {
        const now = new Date();
        gap = date - now;

        const days = Math.floor(gap / 1000 / 60 / 60 / 24);
        const hours = Math.floor(gap / 1000 / 60 / 60) % 24;
        const minutes = Math.floor(gap / 1000 / 60) % 60;
        const seconds = Math.floor(gap / 1000) % 60;

        let second = h % 60;
        second = second < 10 ? `0${second}` : second;

        if (gap < 0) {
            document.querySelector('.time').classList.add('_active');
        }
        const elementD = document.getElementById('d');
        const elementH = document.getElementById('h');
        const elementM = document.getElementById('m');
        const elementS = document.getElementById('s');

        if (elementD) {
            elementD.innerText = `${days} :`;
            elementD.innerHTML = parseInt(days, 10);
        }

        if (elementH) {
            elementH.innerText = `${hours} :`;
            elementH.innerHTML = (`0${hours}`).slice(-2);
        }

        if (elementM) {
            elementM.innerText = `${minutes} :`;
            elementM.innerHTML = (`0${minutes}`).slice(-2);
        }

        if (elementS) {
            elementS.innerText = seconds;
            elementS.innerHTML = (`0${seconds}`).slice(-2);
        }

        function declOfNum(number, titles) {
            const cases = [2, 0, 1, 1, 1, 2];
            return titles[(number % 100 > 4 && number % 100 < 20) ? 2 : cases[(number % 10 < 5) ? number % 10 : 5]];
        }
        document.querySelectorAll('.timer__d').textContent = declOfNum(days, ['день', 'дня', 'дней']);
        document.querySelectorAll('.timer__h').textContent = declOfNum(hours, ['час', 'часа', 'часов']);
        document.querySelectorAll('.timer__m').textContent = declOfNum(minutes, ['минута', 'минуты', 'минут']);
        document.querySelectorAll('.timer__s').textContent = declOfNum(seconds, ['секунда', 'секунды', 'секунд']);
    }
    setInterval(counts, 1000);
    counts();
}
//= =================================================

// invitation_no_5 =====================================
const in5Timer = document.querySelectorAll('.in5-page__timer');
if (in5Timer.length > 0) {
    const date = new Date('2024-12-31T00:00:00');
    function counts() {
        const now = new Date();
        gap = date - now;

        const days = Math.floor(gap / 1000 / 60 / 60 / 24);

        let second = d % 60;
        second = second < 10 ? `0${second}` : second;

        if (gap < 0) {
            document.querySelector('.in5-timer').classList.add('_active');
        }

        const in5ElementD = document.getElementById('d');

        if (in5ElementD) {
            in5ElementD.innerText = `${days} :`;
            in5ElementD.innerHTML = parseInt(days, 10);
        }

        function in5DeclOfNum(number, titles) {
            const cases = [2, 0, 1, 1, 1, 2];
            return titles[(number % 100 > 4 && number % 100 < 20) ? 2 : cases[(number % 10 < 5) ? number % 10 : 5]];
        }
        document.querySelectorAll('.timer__d').textContent = in5DeclOfNum(days, ['день', 'дня', 'дней']);
    }
    setInterval(counts, 1000);
    counts();
}

//= =========

const addToCalendarLink = document.getElementById('addToCalendarLink');

if (addToCalendarLink) {
    addToCalendarLink.addEventListener('click', () => {
        // Замените значения ниже на свои данные о событии
        const eventName = 'Свадьба';
        const eventLocation = 'Место проведения свадьбы';
        const eventStartDate = new Date('2023-12-31T00:00:00');

        const calendarEvent = {
            title: eventName,
            location: eventLocation,
            start: eventStartDate,
        };

        // Формируем ссылку для добавления события в календарь
        const calendarLink = `data:text/calendar;charset=utf-8,${encodeURIComponent(generateCalendarContent(calendarEvent))}`;

        // Создаем временную ссылку и кликаем по ней, чтобы открыть диалог добавления события в календарь
        const downloadLink = document.createElement('a');
        downloadLink.href = calendarLink;
        downloadLink.download = 'event.ics';
        downloadLink.click();

        // Функция для генерации содержимого файла календаря (ICS-формат)
        function generateCalendarContent(event) {
            return `BEGIN:VCALENDAR
            VERSION:2.0
            BEGIN:VEVENT
            SUMMARY:${event.title}
            LOCATION:${event.location}
            DTSTART:${event.start.toISOString().replace(/-|:|\.\d\d\d/g, '')}
            END:VEVENT
            END:VCALENDAR`;
        }
    });
}
//= ==========

//= ================================================================================

// file
const fileContainers = document.querySelectorAll('.file');
const selectedFiles = new FormData(); // Создаем объект FormData для хранения выбранных файлов

fileContainers.forEach((fileContainer) => {
    const formImage = fileContainer.querySelector('.file__input');
    const fileBtn = fileContainer.querySelector('.file__button');
    const formPreview = fileContainer.querySelector('.file__preview');

    if (formImage) {
        formImage.addEventListener('change', () => {
            const { files } = formImage;
            console.log('Files:', files);
            for (let i = 0; i < files.length; i++) {
                selectedFiles.append('files', files[i]);
                uploadFile(formPreview, files[i], fileBtn);
            }

            // Теперь объект FormData selectedFiles содержит все выбранные файлы
            console.log('Selected Files:', selectedFiles.getAll('files'));
        });
    }
});

function uploadFile(formPreview, file, fileBtn) {
    if (!['image/jpeg', 'image/png', 'image/gif'].includes(file.type)) {
        alert('Разрешены только изображения.');
        return;
    }
    if (file.size > 2 * 1024 * 1024) {
        alert('Файл должен быть менее 2 МБ.');
        return;
    }

    const reader = new FileReader();
    reader.onload = function (e) {
        const imgContainer = document.createElement('div');
        imgContainer.classList.add('file__preview-item');

        const img = document.createElement('img');
        img.src = e.target.result;
        img.alt = 'Фото';
        imgContainer.appendChild(img);

        const removeBtn = document.createElement('div');
        removeBtn.classList.add('image-remove');
        removeBtn.textContent = '❌';
        removeBtn.addEventListener('click', () => {
            imgContainer.remove();
            if (formPreview.children.length === 0) {
                formPreview.classList.remove('_active');
                fileBtn.classList.remove('_active');
            }
        });
        imgContainer.appendChild(removeBtn);

        formPreview.appendChild(imgContainer);
        formPreview.classList.add('_active');
        fileBtn.classList.add('_active');
    };
    reader.onerror = function (e) {
        alert('Ошибка');
    };
    reader.readAsDataURL(file);
}
//= ================================================================================
// Показать все шаблоны
document.addEventListener('DOMContentLoaded', () => {
    const closeButton = document.querySelector('.back__close');
    const backContainer = document.querySelector('.back');
    if (backContainer) {
        closeButton.addEventListener('click', () => {
            backContainer.style.display = 'none';
        });

        const templatesButton = document.querySelector('.back__templates');
        const block = document.querySelector('.back__body');

        templatesButton.addEventListener('click', () => {
            block.classList.toggle('_active');
            templatesButton.classList.toggle('_active');

            if (block.classList.contains('_active')) {
                templatesButton.textContent = '➤';
            } else {
                templatesButton.textContent = 'Все шаблоны';
            }
        });
    }
});
//= ================================================================================

// invitation_no_7 =====================================
// Форма добавления подарка
document.addEventListener('DOMContentLoaded', () => {
    const giftForm = document.getElementById('giftForm');
    const selectedGiftsList = document.getElementById('selectedGiftsList');

    if (giftForm) {
        giftForm.addEventListener('submit', (event) => {
            event.preventDefault();

            const selectedRadioButton = giftForm.querySelector('input[type=radio]:checked');

            if (selectedRadioButton) {
                const label = selectedRadioButton.closest('.in7-gifts__item').querySelector('.in7-label-gift');
                const selectedGift = document.createElement('li');
                selectedGift.classList.add('giftImg');
                selectedGift.innerHTML = label.innerHTML;
                selectedGiftsList.appendChild(selectedGift);
                selectedRadioButton.closest('.in7-gifts__item').remove();
                giftForm.querySelector('input[type=submit]').disabled = true;
                giftForm.classList.add('_active');
            }
        });
    }
});
//= ================================================================================
// Определяет какой выбрать слайдер по index
document.querySelectorAll('a[data-slide-index]').forEach((link) => {
    link.addEventListener('click', function (e) {
        e.preventDefault();
        const slideIndex = parseInt(this.getAttribute('data-slide-index'));
        templatesSlider.slideTo(slideIndex);
    });
});
//= ================================================================================

/*
// Оперделяет какой тип шаблона был выбран в Услугах
document.querySelectorAll('.prices__btn').forEach((button) => {
  button.addEventListener('click', (event) => {
    event.preventDefault();
    const selectedTemplate = button.getAttribute('data-template');
    localStorage.setItem('selectedTemplate', selectedTemplate);
    console.log(`Выбран шаблон: ${selectedTemplate}`);
    window.location.href = button.getAttribute('href');
  });
});
document.addEventListener('DOMContentLoaded', () => {
  const selectedTemplate = localStorage.getItem('selectedTemplate');
 
  const templateElements = document.querySelectorAll('.form-survey__items');
  templateElements.forEach((element) => {
    if (element.textContent.trim() === selectedTemplate) {
      element.classList.add('_active');
      const blockId = element.id.replace('template-', '');
      const block = document.getElementById(`${blockId}-block`);
      if (block) {
        block.classList.add('_active');
      }
    } else {
      element.classList.remove('_active');
      const blockId = element.id.replace('template-', '');
      const block = document.getElementById(`${blockId}-block`);
      if (block) {
        block.classList.remove('_active');
      }
    }
  });
});
//= ================================================================================
 
// Оперделяет какой тип шаблона и название шаблона выбрано
document.querySelectorAll('.templates__storage').forEach((button) => {
  button.addEventListener('click', (event) => {
    event.preventDefault();
    const selectedTemplateName = button.getAttribute('data-template-name');
    const selectedTemplateCategory = button.getAttribute('data-template-category');
    localStorage.setItem('selectedTemplateName', selectedTemplateName);
    localStorage.setItem('selectedTemplateCategory', selectedTemplateCategory);
    window.location.href = button.getAttribute('href');
  });
});
 
document.addEventListener('DOMContentLoaded', () => {
  const selectedTemplateName = localStorage.getItem('selectedTemplateName');
  const selectedTemplateCategory = localStorage.getItem('selectedTemplateCategory');
 
  // Установите активный тип шаблона
  const templateTabs = document.querySelectorAll('.form-survey__items');
  templateTabs.forEach((tab) => {
    if (tab.textContent.trim() === selectedTemplateCategory) {
      tab.classList.add('_active');
    } else {
      tab.classList.remove('_active');
    }
  });
 
  // Установите активное название шаблона
  const templateNames = document.querySelectorAll('.survey-label');
  templateNames.forEach((name) => {
    if (name.textContent.trim() === selectedTemplateName) {
      name.previousElementSibling.checked = true;
    }
  });
});
//= ================================================================================
*/
// Функция для отображения попапа спустя 10 секунд
function showPopupAfterDelay() {
    if (!localStorage.getItem('popupShown')) {
        setTimeout(() => {
            const homePage = document.querySelector('#home-page');
            if (homePage) {
                const promotion = document.querySelector('.popup_promotion');
                if (promotion) {
                    promotion.classList.add('_active');
                    localStorage.setItem('popupShown', 'true');
                }
            }
        }, 10000);
    }
}

window.addEventListener('load', showPopupAfterDelay);
//= ================================================================================
// invitation_no_6 =====================================
// Переход к как добраться
const in6Main = document.querySelector('.in6-page');
if (in6Main) {
    const tabItems = document.querySelectorAll('._in6-tabs-item');
    const tabBlocks = document.querySelectorAll('._in6-tabs-block');
    const howToGetThereButton = document.querySelector('.in6-place__path');
    howToGetThereButton.addEventListener('click', () => {
        tabItems.forEach((item, index) => {
            if (item.textContent === 'Как добраться') {
                tabItems.forEach((tab) => tab.classList.remove('_active'));
                item.classList.add('_active');
                tabBlocks.forEach((block) => block.classList.remove('_active'));
                tabBlocks[index].classList.add('_active');
            }
        });
    });
}

const burgerIcon = document.querySelector('.in6-header__icon');
const in6Body = document.querySelector('.in6-page__nav');
if (burgerIcon) {
    burgerIcon.addEventListener('click', () => {
        in6Body.classList.toggle('_active');
        burgerIcon.classList.toggle('_active');
    });
}
//= ================================================================================
// Задайте ваш промокод
const promoCodesDiscounts = {
    Edecor10: 10,
    MARRYME23: 23,
};

const checkLink = document.getElementById('checkLink');
const result = document.getElementById('result');

if (checkLink) {
    checkLink.addEventListener('click', (event) => {
        event.preventDefault();
        checkPromoCode();
    });

    document.addEventListener('click', (event) => {
        if (!checkLink.contains(event.target)) {
            result.classList.remove('_active', '_active-err');
        }
    });
}

function checkPromoCode() {
    const enteredPromoCode = document.getElementById('promoCode').value;

    if (promoCodesDiscounts.hasOwnProperty(enteredPromoCode)) {
        const discount = promoCodesDiscounts[enteredPromoCode];
        result.textContent = `Промокод действителен. Вы получаете скидку ${discount}%`;
        result.classList.add('_active');
        result.classList.remove('_active-err');
    } else {
        result.textContent = 'Промокод недействителен.';
        result.classList.add('_active-err');
        result.classList.remove('_active');
    }
}
// invitation_no_8 =====================================
const in8Bg = document.querySelector('.in8-bg');
if (in8Bg) {
    document.addEventListener('click', (event) => {
        const hid = document.querySelector('.hid');

        if (event.target !== in8Bg) {
            in8Bg.classList.add('_active');
            hid.classList.add('_active');
        }
    });
}

function showPopup(attendanceStatus) {
    const surveyForm = document.querySelector('.in9-form__block');
    const regretText = document.querySelector('.in9-form__regret');
    const attendanceStatusInput = document.getElementById('attendanceStatus');

    if (surveyForm && regretText && attendanceStatusInput) {
        surveyForm.style.display = 'block';
        regretText.style.display = 'none';
        attendanceStatusInput.value = attendanceStatus;
    }
}

function showSurveyBox(attendanceStatus) {
    const surveyForm = document.querySelector('.in9-form__block');
    const regretText = document.querySelector('.in9-form__regret');
    const attendanceStatusInput = document.getElementById('attendanceStatus');

    if (surveyForm && regretText && attendanceStatusInput) {
        surveyForm.style.display = 'none';
        regretText.style.display = 'block';
        attendanceStatusInput.value = attendanceStatus;
    }
}
//= ================================================================================
const policy = document.getElementById('policy');
if (policy) {
    document.querySelector('.wrapper').classList.add('policy');
}

document.addEventListener('DOMContentLoaded', () => {
    const forms = document.querySelectorAll('form');
    if (forms.length > 0) {
        for (let index = 0; index < forms.length; index++) {
            const el = forms[index];
            el.addEventListener('submit', formSend);
        }
    }

    async function formSend(e) {
        const btn = e.target;
        const form = btn.closest('form');
        const error = form_validate(form);
        if (error === 0) {
            const formAction = form.getAttribute('action') ? form.getAttribute('action').trim() : '#';
            const formMethod = form.getAttribute('method') ? form.getAttribute('method').trim() : 'POST';

                  // SendForm
      if (formAction.length > 2) {
        e.preventDefault();
        const formData = new FormData(form);
        form.classList.add('_sending');
        try {
          await initializeRecaptcha();
          const token = document.getElementById('g-recaptcha-response').value;
          formData.append('g-recaptcha-response', token);
        } catch (error) {
          console.error('Ошибка при инициализации reCAPTCHA:', error);
          form.classList.remove('_sending');
        }

        // const_file_upll = selectedFiles.getAll('files');
        // for (let i = 0; i < const_file_upll.length; i++) {
        //   const dataTransfer = new DataTransfer();
        //   dataTransfer.items.add(const_file_upll[i]);

        //   formData.append(`files_${i}`, dataTransfer.files[0]);
        // }

        fetch(formAction, {
          method: formMethod,
          body: formData,
        })
          .then((response) => {
            console.log('HTTP response:', response);  // Посмотреть объект HTTP-ответа
            return response.json();  // Преобразование ответа в JSON
          })
          .then((response) => {
            console.log('Response JSON:', response);  // Посмотреть содержимое ответа после преобразования в JSON
            if (response.result === 'success') {
              console.log(response);
              document.querySelector('.popup_thanks').classList.toggle('_active');
              form.classList.remove('_sending');
              form.reset();
            } else {
              alert('Вы не прошли проверку reCAPTCHA. Пожалуйста, повторите попытку.');
              form.classList.remove('_sending');
              console.log(response);
            }
          })


          .catch((err) => {
            console.log('Fetch error:', err);  // Вывод ошибки, если она произойдет во время запроса
            form.classList.remove('_sending');
            alert('Произошла ошибка при отправке формы');
          });
      }
      // If test
      if (form.hasAttribute('data-test')) {
        e.preventDefault();
        if (message) {
          popup_open(`${message}-message`);
        }
        form_clean(form);
      }
    } else {
      const form_error = form.querySelectorAll('._error');
      if (form_error && form.classList.contains('_goto-error')) {
        _goto(form_error[0], 1000, 50);
      }
      e.preventDefault();
    }
  }
  async function initializeRecaptcha() {
    return new Promise((resolve, reject) => {
      grecaptcha.enterprise.ready(() => {
        grecaptcha.enterprise.execute('6Lc9Q-kpAAAAABPME8-R-wSWKJeqkJ5YH92vT_XQ', { action: 'submit' }).then((token) => {
          document.getElementById('g-recaptcha-response').value = token;
          resolve();
        }).catch(reject);
      });
    });
  }
    function form_validate(form) {
        let error = 0;
        const form_req = form.querySelectorAll('._req');
        if (form_req.length > 0) {
            for (let index = 0; index < form_req.length; index++) {
                const el = form_req[index];
                if (!_is_hidden(el)) {
                    error += form_validate_input(el);
                }
            }
        }
        return error;
    }
    function form_validate_input(input) {
        let error = 0;
        const input_g_value = input.getAttribute('data-value');

        if (input.getAttribute('name') == 'email' || input.classList.contains('_email')) {
            if (input.value != input_g_value) {
                const em = input.value.replace(' ', '');
                input.value = em;
            }
            if (email_test(input) || input.value == input_g_value) {
                form_add_error(input);
                error++;
            } else {
                form_remove_error(input);
            }
        } else if (input.getAttribute('type') == 'checkbox' && input.checked == false) {
            form_add_error(input);
            error++;
        } else if (input.value == '' || input.value == input_g_value) {
            form_add_error(input);
            error++;
        } else {
            form_remove_error(input);
        }
        return error;
    }
    function form_add_error(input) {
        input.classList.add('_error');
        input.parentElement.classList.add('_error');

        const input_error = input.parentElement.querySelector('.form__error');
        if (input_error) {
            input.parentElement.removeChild(input_error);
        }
        const input_error_text = input.getAttribute('data-error');
        if (input_error_text && input_error_text != '') {
            input.parentElement.insertAdjacentHTML('beforeend', `<div class="form__error">${input_error_text}</div>`);
        }
    }
    function form_remove_error(input) {
        input.classList.remove('_error');
        input.parentElement.classList.remove('_error');

        const input_error = input.parentElement.querySelector('.form__error');
        if (input_error) {
            input.parentElement.removeChild(input_error);
        }
    }
    function form_clean(form) {
        const inputs = form.querySelectorAll('input,textarea');
        for (let index = 0; index < inputs.length; index++) {
            const el = inputs[index];
            el.parentElement.classList.remove('_focus');
            el.classList.remove('_focus');
            el.value = el.getAttribute('data-value');
        }
        const checkboxes = form.querySelectorAll('.checkbox__input');
        if (checkboxes.length > 0) {
            for (let index = 0; index < checkboxes.length; index++) {
                const checkbox = checkboxes[index];
                checkbox.checked = false;
            }
        }
        const selects = form.querySelectorAll('select');
        if (selects.length > 0) {
            for (let index = 0; index < selects.length; index++) {
                const select = selects[index];
                const select_default_value = select.getAttribute('data-default');
                select.value = select_default_value;
                select_item(select);
            }
        }
    }
});

// viewPass
const viewPass = document.querySelectorAll('._viewpass');
for (let index = 0; index < viewPass.length; index++) {
    const element = viewPass[index];
    element.addEventListener('click', (e) => {
        if (element.classList.contains('_active')) {
            element.parentElement.querySelector('input').setAttribute('type', 'password');
        } else {
            element.parentElement.querySelector('input').setAttribute('type', 'text');
        }
        element.classList.toggle('_active');
    });
}

// Select
const selects = document.getElementsByTagName('select');
if (selects.length > 0) {
    selects_init();
}
function selects_init() {
    for (let index = 0; index < selects.length; index++) {
        const select = selects[index];
        select_init(select);
    }
    // select_callback();
    document.addEventListener('click', (e) => {
        selects_close(e);
    });
    document.addEventListener('keydown', (e) => {
        if (e.code === 'Escape') {
            selects_close(e);
        }
    });
}
function selects_close(e) {
    const selects = document.querySelectorAll('.select');
    if (!e.target.closest('.select') && !e.target.classList.contains('_option')) {
        for (let index = 0; index < selects.length; index++) {
            const select = selects[index];
            const select_body_options = select.querySelector('.select__options');
            select.classList.remove('_active');
            _slideUp(select_body_options, 100);
        }
    }
}
function select_init(select) {
    const select_parent = select.parentElement;
    const select_modifikator = select.getAttribute('class');
    const select_selected_option = select.querySelector('option:checked');
    select.setAttribute('data-default', select_selected_option.value);
    select.style.display = 'none';

    select_parent.insertAdjacentHTML('beforeend', `<div class="select select_${select_modifikator}"></div>`);

    const new_select = select.parentElement.querySelector('.select');
    new_select.appendChild(select);
    select_item(select);
}
function select_item(select) {
    const select_parent = select.parentElement;
    const select_items = select_parent.querySelector('.select__item');
    const select_options = select.querySelectorAll('option');
    const select_selected_option = select.querySelector('option:checked');
    const select_selected_text = select_selected_option.text;
    const select_type = select.getAttribute('data-type');

    if (select_items) {
        select_items.remove();
    }

    let select_type_content = '';
    if (select_type == 'input') {
        select_type_content = `<div class="select__value icon-select-arrow"><input autocomplete="off" type="text" name="selectLang" value="${select_selected_text}" data-error="Ошибка" data-value="${select_selected_text}" class="select__input"></div>`;
    } else {
        select_type_content = `<div class="select__value icon-select-arrow"><span>${select_selected_text}</span></div>`;
    }

    select_parent.insertAdjacentHTML(
        'beforeend',
        '<div class="select__item">'
        + `<div class="select__title">${select_type_content}</div>`
        + `<div hidden class="select__options">${select_get_options(select_options)}</div>`
        + '</div></div>',
    );

    select_actions(select, select_parent);
}
function select_actions(original, select) {
    const select_item = select.querySelector('.select__item');
    const selectTitle = select.querySelector('.select__title');
    const select_body_options = select.querySelector('.select__options');
    const select_options = select.querySelectorAll('.select__option');
    const select_type = original.getAttribute('data-type');
    const select_input = select.querySelector('.select__input');

    selectTitle.addEventListener('click', (e) => {
        selectItemActions();
    });

    function selectMultiItems() {
        const selectedOptions = select.querySelectorAll('.select__option');
        const originalOptions = original.querySelectorAll('option');
        const selectedOptionsText = [];
        for (let index = 0; index < selectedOptions.length; index++) {
            const selectedOption = selectedOptions[index];
            originalOptions[index].removeAttribute('selected');
            if (selectedOption.classList.contains('_selected')) {
                const selectOptionText = selectedOption.innerHTML;
                selectedOptionsText.push(selectOptionText);
                originalOptions[index].setAttribute('selected', 'selected');
            }
        }
        select.querySelector('.select__value').innerHTML = `<span>${selectedOptionsText}</span>`;
    }
    function selectItemActions(type) {
        if (!type) {
            const selects = document.querySelectorAll('.select');
            for (let index = 0; index < selects.length; index++) {
                const select = selects[index];
                const select_body_options = select.querySelector('.select__options');
                if (select != select_item.closest('.select')) {
                    select.classList.remove('_active');
                    _slideUp(select_body_options, 100);
                }
            }
            _slideToggle(select_body_options, 100);
            select.classList.toggle('_active');
        }
    }
    for (let index = 0; index < select_options.length; index++) {
        const select_option = select_options[index];
        const select_option_value = select_option.getAttribute('data-value');
        const select_option_text = select_option.innerHTML;

        if (select_type == 'input') {
            select_input.addEventListener('keyup', select_search);
        } else if (select_option.getAttribute('data-value') == original.value && !original.hasAttribute('multiple')) {
            select_option.style.display = 'none';
        }
        select_option.addEventListener('click', () => {
            for (let index = 0; index < select_options.length; index++) {
                const el = select_options[index];
                el.style.display = 'block';
            }
            if (select_type == 'input') {
                select_input.value = select_option_text;
                original.value = select_option_value;
            } else if (original.hasAttribute('multiple')) {
                select_option.classList.toggle('_selected');
                selectMultiItems();
            } else {
                function URLLanguage(page, title, url) {
                    if (typeof history.pushState !== 'undefined') {
                        history.pushState({ page }, title, url);
                        select.querySelector('.select__value').innerHTML = `<span>${select_option_text}</span>`;
                    } else {
                        window.location.assign(url);
                    }
                }
                URLLanguage('another page', 'example', select_option_text);

                original.value = select_option_value;
                select_option.style.display = 'none';
            }
            let type;
            if (original.hasAttribute('multiple')) {
                type = 'multiple';
            }
            selectItemActions(type);
        });
    }
}
function select_get_options(select_options) {
    if (select_options) {
        let select_options_content = '';
        for (let index = 0; index < select_options.length; index++) {
            const select_option = select_options[index];
            const select_option_value = select_option.value;
            if (select_option_value != '') {
                const select_option_text = select_option.innerHTML;
                select_options_content = `${select_options_content}<div data-value="${select_option_value}" class="select__option">${select_option_text}</div>`;
            }
        }
        return select_options_content;
    }
}
function select_search(e) {
    const select_block = e.target.closest('.select ').querySelector('.select__options');
    const select_options = e.target.closest('.select ').querySelectorAll('.select__option');
    const select_search_text = e.target.value.toUpperCase();

    for (let i = 0; i < select_options.length; i++) {
        const select_option = select_options[i];
        const select_txt_value = select_option.textContent || select_option.innerText;
        if (select_txt_value.toUpperCase().indexOf(select_search_text) > -1) {
            select_option.style.display = '';
        } else {
            select_option.style.display = 'none';
        }
    }
}
function selects_update_all() {
    const selects = document.querySelectorAll('select');
    if (selects) {
        for (let index = 0; index < selects.length; index++) {
            const select = selects[index];
            select_item(select);
        }
    }
}

// Placeholers
const inputs = document.querySelectorAll('input[data-value]');
inputs_init(inputs);

function inputs_init(inputs) {
    if (inputs.length > 0) {
        for (let index = 0; index < inputs.length; index++) {
            const input = inputs[index];
            const input_g_value = input.getAttribute('data-value');
            input_placeholder_add(input);
            if (input.value != '' && input.value != input_g_value) {
                input_focus_add(input);
            }
            if (input.value == input_g_value) {
                input_focus_add(input);
                input.value = '';
            }
            if (input.getAttribute('data-type') === 'pass') {
                if (input.parentElement.querySelector('._viewpass')) {
                    if (!input.parentElement.querySelector('._viewpass').classList.contains('_active')) {
                        input.setAttribute('type', 'password');
                    }
                } else {
                    input.setAttribute('type', 'password');
                }
            }
            if (input) {
                document.querySelectorAll('._data').forEach((input, index) => {
                    Inputmask('(01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26|27|28|29|30|31).(01|02|03|04|05|06|07|08|09|10|11|12).(1|2)999', {
                        clearIncomplete: true,
                        clearMaskOnLostFocus: true,
                    }).mask(input);
                });
            }
            if (input) {
                document.querySelectorAll('._phone').forEach((input, index) => {
                    Inputmask('+7(999) 999 9999', {
                        clearIncomplete: true,
                        clearMaskOnLostFocus: true,
                    }).mask(input);
                });
            }
            if (input) {
                document.querySelectorAll('._digital').forEach((input, index) => {
                    Inputmask('9{1,}', {
                        placeholder: '',
                        clearIncomplete: true,
                        clearMaskOnLostFocus: true,
                    }).mask(input);
                });
            }
        }
    }
}
function input_placeholder_add(input) {
    const input_g_value = input.getAttribute('data-value');
    if (input.value == '' && input_g_value != '') {
        input.value = input_g_value;
    }
}
function input_focus_add(input) {
    input.classList.add('_focus');
    input.parentElement.classList.add('_focus');
}
function input_focus_remove(input) {
    input.classList.remove('_focus');
    input.parentElement.classList.remove('_focus');
}
function input_clear_mask(input, input_g_value) {
    input.inputmask.remove();
    input.value = input_g_value;
    input_focus_remove(input);
}

const scr_body = document.querySelector('body');
const scr_blocks = document.querySelectorAll('._scr-sector');
const scr_items = document.querySelectorAll('._scr-item');
const scr_fix_block = document.querySelectorAll('._side-wrapper');
const scr_min_height = 750;

let scrolling = true;
let scrolling_full = true;

let scrollDirection = 0;

let currentScroll;

// ScrollOnScroll
window.addEventListener('scroll', scroll_scroll);
function scroll_scroll() {
    const src_value = currentScroll = pageYOffset;
    const header = document.querySelector('header.header');
    if (header !== null) {
        if (src_value > 10) {
            header.classList.add('_scroll');
        } else {
            header.classList.remove('_scroll');
        }
    }
    if (scr_blocks.length > 0) {
        for (let index = 0; index < scr_blocks.length; index++) {
            const block = scr_blocks[index];
            const block_offset = offset(block).top;
            const block_height = block.offsetHeight;

            /*
                  if ((src_value > block_offset - block_height) && src_value < (block_offset + block_height) && window.innerHeight > scr_min_height && window.innerWidth > 992) {
                      let scrProcent = (src_value - block_offset) / block_height * 100;
                      scrParallax(block, scrProcent, block_height);
                  }
                  */

            if ((pageYOffset > block_offset - window.innerHeight / 1.5) && pageYOffset < (block_offset + block_height) - window.innerHeight / 5) {
                block.classList.add('_scr-sector_active');
            } else if (block.classList.contains('_scr-sector_active')) {
                block.classList.remove('_scr-sector_active');
            }
            if ((pageYOffset > block_offset - window.innerHeight / 2) && pageYOffset < (block_offset + block_height) - window.innerHeight / 5) {
                if (!block.classList.contains('_scr-sector_current')) {
                    block.classList.add('_scr-sector_current');
                }
            } else if (block.classList.contains('_scr-sector_current')) {
                block.classList.remove('_scr-sector_current');
            }
        }
    }
    if (scr_items.length > 0) {
        for (let index = 0; index < scr_items.length; index++) {
            const scr_item = scr_items[index];
            const scr_item_offset = offset(scr_item).top;
            const scr_item_height = scr_item.offsetHeight;

            let scr_item_point = window.innerHeight - (window.innerHeight - scr_item_height / 3);
            if (window.innerHeight > scr_item_height) {
                scr_item_point = window.innerHeight - scr_item_height / 3;
            }

            if ((src_value > scr_item_offset - scr_item_point) && src_value < (scr_item_offset + scr_item_height)) {
                scr_item.classList.add('_active');
                scroll_load_item(scr_item);
            } else {
                scr_item.classList.remove('_active');
            }
            if (((src_value > scr_item_offset - window.innerHeight))) {
                if (scr_item.querySelectorAll('._lazy').length > 0) {
                    scroll_lazy(scr_item);
                }
            }
        }
    }
    if (scr_fix_block.length > 0) {
        fix_block(scr_fix_block, src_value);
    }
    const custom_scroll_line = document.querySelector('._custom-scroll__line');
    if (custom_scroll_line) {
        const window_height = window.innerHeight;
        const content_height = document.querySelector('.wrapper').offsetHeight;
        const scr_procent = (pageYOffset / (content_height - window_height)) * 100;
        const custom_scroll_line_height = custom_scroll_line.offsetHeight;
        custom_scroll_line.style.transform = `translateY(${(window_height - custom_scroll_line_height) / 100 * scr_procent}px)`;
    }
    if (src_value > scrollDirection) {
        // downscroll code
    } else {
        // upscroll code
    }
    scrollDirection = src_value <= 0 ? 0 : src_value;
}
setTimeout(() => {
    // document.addEventListener("DOMContentLoaded", scroll_scroll);
    scroll_scroll();
}, 100);

function scroll_lazy(scr_item) {
    /*
      let lazy_src = scr_item.querySelectorAll('*[data-src]');
      if (lazy_src.length > 0) {
          for (let index = 0; index < lazy_src.length; index++) {
              const el = lazy_src[index];
              if (!el.classList.contains('_loaded')) {
                  el.setAttribute('src', el.getAttribute('data-src'));
                  el.classList.add('_loaded');
              }
          }
      }
      let lazy_srcset = scr_item.querySelectorAll('*[data-srcset]');
      if (lazy_srcset.length > 0) {
          for (let index = 0; index < lazy_srcset.length; index++) {
              const el = lazy_srcset[index];
              if (!el.classList.contains('_loaded')) {
                  el.setAttribute('srcset', el.getAttribute('data-srcset'));
                  el.classList.add('_loaded');
              }
          }
      }
      */
    /*
      window.onload = () => {
          const observer = new IntersectionObserver((entries, observer) => {
              entries.forEach(entry => {
                  if (entry.isIntersecting) {
                      console.log(entry)
                      // ссылка на оригинальное изображение хранится в атрибуте "data-src"
                      entry.target.src = entry.target.dataset.src
                      observer.unobserve(entry.target)
                  }
              })
          }, { threshold: 0.5 })
  
          document.querySelectorAll('img').forEach(img => observer.observe(img))
      }
      */
}
function scroll_load_item(scr_item) {
    if (scr_item.classList.contains('_load-map') && !scr_item.classList.contains('_loaded-map')) {
        const map_item = document.getElementById('map');
        if (map_item) {
            scr_item.classList.add('_loaded-map');
            map();
        }
    }
}
function scrParallax(block, scrProcent, blockHeight) {
    const prlxItems = block.querySelectorAll('._prlx-item');
    if (prlxItems.length > 0) {
        for (let index = 0; index < prlxItems.length; index++) {
            const prlxItem = prlxItems[index];
            const prlxItemAttr = (prlxItem.dataset.prlx) ? prlxItem.dataset.prlx : 3;
            const prlxItemValue = -1 * (blockHeight / 100 * scrProcent / prlxItemAttr);
            prlxItem.style.cssText = `transform: translateY(${prlxItemValue}px);`;
        }
    }
}
// FullScreenScroll
if (scr_blocks.length > 0 && !isMobile.any()) {
    disableScroll();
    window.addEventListener('wheel', full_scroll);

    const swiperScrolls = document.querySelectorAll('._swiper_scroll');

    if (swiperScrolls.length > 0) {
        for (let index = 0; index < swiperScrolls.length; index++) {
            const swiperScroll = swiperScrolls[index];
            swiperScroll.addEventListener('mouseenter', (e) => {
                window.removeEventListener('wheel', full_scroll);
            });
            swiperScroll.addEventListener('mouseleave', (e) => {
                window.addEventListener('wheel', full_scroll);
            });
        }
    }
}
function getPrevBlockPos(current_block_prev) {
    const viewport_height = window.innerHeight;
    const current_block_prev_height = current_block_prev.offsetHeight;
    let block_pos = offset(current_block_prev).top;

    if (current_block_prev_height >= viewport_height) {
        block_pos += (current_block_prev_height - viewport_height);
    }
    return block_pos;
}
function full_scroll(e) {
    const viewport_height = window.innerHeight;
    if (viewport_height >= scr_min_height) {
        if (scrolling_full) {
            const current_block = document.querySelector('._scr-sector._scr-sector_current');
            const current_block_pos = offset(current_block).top;
            const current_block_height = current_block.offsetHeight;
            const current_block_next = current_block.nextElementSibling;
            const current_block_prev = current_block.previousElementSibling;
            if (e.keyCode == 40 || e.keyCode == 34 || e.deltaX > 0 || e.deltaY < 0) {
                if (current_block_height <= viewport_height) {
                    if (current_block_prev) {
                        full_scroll_to_sector(getPrevBlockPos(current_block_prev));
                    }
                } else {
                    enableScroll();
                    if (currentScroll <= current_block_pos) {
                        if (current_block_prev) {
                            full_scroll_to_sector(getPrevBlockPos(current_block_prev));
                        }
                    }
                }
            } else if (e.keyCode == 38 || e.keyCode == 33 || e.deltaX < 0 || e.deltaY > 0) {
                if (current_block_height <= viewport_height) {
                    if (current_block_next) {
                        const block_pos = offset(current_block_next).top;
                        full_scroll_to_sector(block_pos);
                    }
                } else {
                    enableScroll();
                    if (current_block_next) {
                        const block_pos = offset(current_block_next).top;
                        if (currentScroll >= block_pos - viewport_height) {
                            full_scroll_to_sector(block_pos);
                        }
                    }
                }
            }
        } else {
            disableScroll();
        }
    } else {
        enableScroll();
    }
}
function full_scroll_to_sector(pos) {
    disableScroll();
    scrolling_full = false;
    _goto(pos, 800);

    let scr_pause = 500;
    if (navigator.appVersion.indexOf('Mac') != -1) {
        scr_pause = 1000;
    }
    setTimeout(() => {
        scrolling_full = true;
    }, scr_pause);
}
function full_scroll_pagestart() { }
function full_scroll_pageend() { }

// ScrollOnClick (Navigation)
const link = document.querySelectorAll('._goto-block');
if (link) {
    const blocks = [];
    for (let index = 0; index < link.length; index++) {
        const el = link[index];
        const block_name = el.getAttribute('href').replace('#', '');
        if (block_name != '' && !~blocks.indexOf(block_name)) {
            blocks.push(block_name);
        }
        el.addEventListener('click', (e) => {
            if (document.querySelector('.menu__body._active, .in1-menu__body._active, .in4-menu__body._active, .in5-menu__body._active, .in7-menu__body._active , .in10-menu__body._active')) {
                menu_close();
                body_lock_remove(500);
            }
            const target_block_class = el.getAttribute('href').replace('#', '');
            const target_block = document.querySelector(`.${target_block_class}`);
            _goto(target_block, 300);
            e.preventDefault();
        });
    }

    window.addEventListener('scroll', (el) => {
        const old_current_link = document.querySelectorAll('._goto-block._active');
        if (old_current_link) {
            for (let index = 0; index < old_current_link.length; index++) {
                const el = old_current_link[index];
                el.classList.remove('_active');
            }
        }
        for (let index = 0; index < blocks.length; index++) {
            const block = blocks[index];
            const block_item = document.querySelector(`._goto-block[href="#${block}"]`);
            if (block_item) {
                const block_offset = offset(block_item).top;
                const block_height = block_item.offsetHeight;
                if ((pageYOffset > block_offset - window.innerHeight / 3) && pageYOffset < (block_offset + block_height) - window.innerHeight / 3) {
                    const current_links = document.querySelectorAll(`._goto-block[href="#${block}"]`);
                    for (let index = 0; index < current_links.length; index++) {
                        const current_link = current_links[index];
                        current_link.classList.add('_active');
                    }
                }
            }
        }
    });
}
// ScrollOnClick (Simple)
const goto_links = document.querySelectorAll('._goto');
if (goto_links) {
    for (let index = 0; index < goto_links.length; index++) {
        const goto_link = goto_links[index];
        goto_link.addEventListener('click', (e) => {
            const target_block_class = goto_link.getAttribute('href').replace('#', '');
            const target_block = document.querySelector(`.${target_block_class}`);
            _goto(target_block, 300);
            e.preventDefault();
        });
    }
}
function _goto(target_block, speed, offset = 0) {
    const header = '';
    // OffsetHeader
    // if (window.innerWidth < 992) {
    //	header = 'header';
    // }
    const options = {
        speedAsDuration: true,
        speed,
        header,
        offset,
        easing: 'easeOutQuad',
    };
    const scr = new SmoothScroll();
    scr.animateScroll(target_block, '', options);
}

// SameFunctions
function offset(el) {
    const rect = el.getBoundingClientRect();
    const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    return { top: rect.top + scrollTop, left: rect.left + scrollLeft };
}
function disableScroll() {
    if (window.addEventListener) // older FF
    { window.addEventListener('DOMMouseScroll', preventDefault, false); }
    document.addEventListener('wheel', preventDefault, { passive: false }); // Disable scrolling in Chrome
    window.onwheel = preventDefault; // modern standard
    window.onmousewheel = document.onmousewheel = preventDefault; // older browsers, IE
    window.ontouchmove = preventDefault; // mobile
    document.onkeydown = preventDefaultForScrollKeys;
}
function enableScroll() {
    if (window.removeEventListener) { window.removeEventListener('DOMMouseScroll', preventDefault, false); }
    document.removeEventListener('wheel', preventDefault, { passive: false }); // Enable scrolling in Chrome
    window.onmousewheel = document.onmousewheel = null;
    window.onwheel = null;
    window.ontouchmove = null;
    document.onkeydown = null;
}
function preventDefault(e) {
    e = e || window.event;
    if (e.preventDefault) { e.preventDefault(); }
    e.returnValue = false;
}
function preventDefaultForScrollKeys(e) {
    /* if (keys[e.keyCode]) {
          preventDefault(e);
          return false;
      } */
}

function fix_block(scr_fix_block, scr_value) {
    const window_width = parseInt(window.innerWidth);
    const window_height = parseInt(window.innerHeight);
    const header_height = parseInt(document.querySelector('header').offsetHeight) + 15;
    for (let index = 0; index < scr_fix_block.length; index++) {
        const block = scr_fix_block[index];
        let block_width = block.getAttribute('data-width');
        const item = block.querySelector('._side-block');
        if (!block_width) { block_width = 0; }
        if (window_width > block_width) {
            if (item.offsetHeight < window_height - (header_height + 30)) {
                if (scr_value > offset(block).top - (header_height + 15)) {
                    item.style.cssText = `position:fixed;bottom:auto;top:${header_height}px;width:${block.offsetWidth}px;left:${offset(block).left}px;`;
                } else {
                    gotoRelative(item);
                }
                if (scr_value > (block.offsetHeight + offset(block).top) - (item.offsetHeight + (header_height + 15))) {
                    block.style.cssText = 'position:relative;';
                    item.style.cssText = 'position:absolute;bottom:0;top:auto;left:0px;width:100%';
                }
            } else {
                gotoRelative(item);
            }
        }
    }
    function gotoRelative(item) {
        item.style.cssText = 'position:relative;bottom:auto;top:0px;left:0px;';
    }
}

if (!isMobile.any()) {
    // custom_scroll();
    /*
      window.addEventListener('wheel', scroll_animate, {
          capture: true,
          passive: true
      });
      window.addEventListener('resize', custom_scroll, {
          capture: true,
          passive: true
      });
      */
}
function custom_scroll(event) {
    scr_body.style.overflow = 'hidden';
    const window_height = window.innerHeight;
    let custom_scroll_line = document.querySelector('._custom-scroll__line');
    const custom_scroll_content_height = document.querySelector('.wrapper').offsetHeight;
    const custom_cursor_height = Math.min(window_height, Math.round(window_height * (window_height / custom_scroll_content_height)));
    if (custom_scroll_content_height > window_height) {
        if (!custom_scroll_line) {
            const custom_scroll = document.createElement('div');
            custom_scroll_line = document.createElement('div');
            custom_scroll.setAttribute('class', '_custom-scroll');
            custom_scroll_line.setAttribute('class', '_custom-scroll__line');
            custom_scroll.appendChild(custom_scroll_line);
            scr_body.appendChild(custom_scroll);
        }
        custom_scroll_line.style.height = `${custom_cursor_height}px`;
    }
}

let new_pos = pageYOffset;
function scroll_animate(event) {
    const window_height = window.innerHeight;
    const content_height = document.querySelector('.wrapper').offsetHeight;
    const start_position = pageYOffset;
    const pos_add = 100;

    if (event.keyCode == 40 || event.keyCode == 34 || event.deltaX > 0 || event.deltaY < 0) {
        new_pos -= pos_add;
    } else if (event.keyCode == 38 || event.keyCode == 33 || event.deltaX < 0 || event.deltaY > 0) {
        new_pos += pos_add;
    }
    if (new_pos > (content_height - window_height)) new_pos = content_height - window_height;
    if (new_pos < 0) new_pos = 0;

    if (scrolling) {
        scrolling = false;
        _goto(new_pos, 1000);

        let scr_pause = 100;
        if (navigator.appVersion.indexOf('Mac') != -1) {
            scr_pause *= 2;
        }
        setTimeout(() => {
            scrolling = true;
            _goto(new_pos, 1000);
        }, scr_pause);
    }
    // If native scroll
    // disableScroll();
}

